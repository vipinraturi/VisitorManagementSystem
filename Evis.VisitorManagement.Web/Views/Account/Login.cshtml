@model Evis.VisitorManagement.Web.ViewModel.LoginViewModel
@{
    Layout = "~/Views/Shared/_LoginLayout.cshtml";
}

<div class="top-content">
    <div class="">
        <div class="container">
            <div class="row">
                <div class="col-sm-6 col-sm-offset-3 form-box">
                    <div class="form-top">
                        <div class="form-top-left">
                            <h3>Login to our site</h3>
                            <p>Enter your username and password to log on:</p>
                        </div>
                        <div class="form-top-right">
                            <i class="fa fa-key"></i>
                        </div>
                    </div>
                    <div class="form-bottom">
                        <form ng-app="loginApp" ng-controller="loginController" name="loginForm" novalidate>
                            <div class="form-group">
                                <p>
                                    Username:<br>
                                    <input id="Username" type="text" name="user" ng-model="user" class="form-username form-control" required>
                                    <span style="color:red" ng-show="loginForm.user.$invalid">
                                        <span ng-show="loginForm.user.$error.required">Username is required.</span>
                                    </span>
                                </p>
                                <p>
                                    Password:<br>
                                    <input id="Password" type="password" name="password" ng-model="password" class="form-username form-control" required>
                                    <span style="color:red" ng-show="loginForm.password.$invalid">
                                        <span ng-show="loginForm.password.$error.required">Password is required.</span>
                                    </span>
                                </p>
                                <p>
                                    <button id="btnSubmit" type="button" class="btn" ng-click="SignIn()"
                                            ng-disabled="loginForm.user.$invalid || loginForm.email.$invalid">
                                        Sign In
                                    </button>
                                    <span style="color:red" ng-show="loginForm.error.$invalid">
                                        <span ng-show="loginForm.error.$error.message">Invalid User Credentials!</span>
                                    </span>
                                </p>
                            </div>
                        </form>
                        @*@using (Html.BeginForm("", "", FormMethod.Post, new { ng_app = "myApp", ng_controller = "validateCtrl", name = "myForm" }))
                            {
                                <div class="form-group">
                                    @Html.LabelFor(m => m.UserName, new { @class = "sr-only" })
                                    @Html.TextBoxFor(m => m.UserName, new { @class = "form-username form-control", @placeholder = "Username...", ng_model = "user", required = "required" })
                                    <span style="color:red" ng-show="myForm.user.$dirty && myForm.user.$invalid">
                                        <span ng-show="myForm.user.$error.required">Username is required.</span>
                                    </span>
                                </div>
                                <div class="form-group">
                                    @Html.LabelFor(m => m.Password, new { @class = "sr-only" })
                                    @Html.PasswordFor(m => m.Password, new { @class = "form-username form-control", @placeholder = "Password...", ng_model = "email", ng_minlength = "8", required = "required" })
                                    <span style="color:red" ng-show="myForm.email.$dirty && myForm.email.$invalid">
                                        <span ng-show="myForm.email.$error.required">Email is required.</span>
                                        <span ng-show="myForm.email.$error.minlength">Password should be of 8 characters.</span>
                                    </span>
                                </div>
                                <button id="btnSubmit" type="submit" class="btn">Sign in!</button>
                            }*@
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-6 col-sm-offset-3 social-login">
                        <h3>...or login with:</h3>
                        <div class="social-login-buttons">
                            <a class="btn btn-link-1 btn-link-1-facebook" href="#">
                                <i class="fa fa-facebook"></i> Facebook
                            </a>
                            <a class="btn btn-link-1 btn-link-1-twitter" href="#">
                                <i class="fa fa-twitter"></i> Twitter
                            </a>
                            <a class="btn btn-link-1 btn-link-1-google-plus" href="#">
                                <i class="fa fa-google-plus"></i> Google Plus
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    var app = angular.module('loginApp', []);
    app.controller('loginController', function ($scope, $http) {

        $scope.user = '';//username@domain.com
        $scope.password = '';//********

        $scope.SignIn = function () {

            var viewModel = {
                "Username": $scope.user,
                "Password": $scope.password
            };

            $http.post(
                '/Api/AccountApi/Login',
                JSON.stringify(viewModel),
                {
                    headers: {
                        'Content-Type': 'application/json'
                    }
                }
            ).success(function (data) {
                window.location.href = '@Url.Action("Index", "Dashboard")';
                console.log('success post');
            }).error(function () {
                //debugger;
                $scope.error.$invalid = "An Error has occured";
            });
        };

    });

    @*$(document).ready(function () {
        $("#btnSubmit").click(function () {

            var viewModel = {
                "Username": $("#UserName").val(),
                "Password": $("#Password").val()
            };
            JSON.stringify(viewModel);
            debugger;
            $.ajax({
                url: "http://localhost:54608/Api/AccountApi",
                type: "Post",
                data: JSON.stringify(viewModel), //{ Name: name,
                contentType: 'application/json; charset=utf-8',
                success: function (data) {
                    debugger;
                    console.log(data);
                    window.location.href = '@Url.Action("Register", "Account")';
                },
                error: function () {
                    alert('error');
                }
            });
        });
    });*@

</script>

@*<script type="text/javascript">



        $(document).ready(function () {


            var app = angular.module('myApp', []);

            app.controller('validateCtrl', function ($scope) {
                $scope.user = '';
                $scope.password = '';
            });



            @*$("#btnSubmit").click(function () {

                var viewModel = {
                    "Username": $("#UserName").val(),
                    "Password": $("#Password").val()
                };
                JSON.stringify(viewModel);
                debugger;
                $.ajax({
                    url: "http://localhost:54608/Api/AccountApi",
                    type: "Post",
                    data: JSON.stringify(viewModel), //{ Name: name,
                    contentType: 'application/json; charset=utf-8',
                    success: function (data) {
                        debugger;
                        console.log(data);
                        window.location.href = '@Url.Action("Register", "Account")';
                    },
                    error: function () {
                        alert('error');
                    }
                });
            });
        });
    </script>*@




